## Turbine
- turbine 如何传播区块
  - 在传播区块之前（即传输到网络中的其他验证器），领导者根据传入的交易流构建并排序该区块。
  - 当领导者构建并提出整个区块时，实际数据会作为碎片（部分区块）发送到网络中的其他验证者。碎片是验证器之间发送的原子单元
  - Turbine 获取碎片并将它们发送到一组预定的验证器，然后验证器将这些碎片转发给一组新的验证器。
  - ![区块传播](https://image.blockbeats.cn/upload/2023-10-25/c02aaa2f8335d90a5600265e698747aea0b0b51a.png?x-oss-process=image/quality,q_50/watermark,image_d2F0ZXJtYXJrbmV3LnBuZz94LW9zcy1wcm9jZXNzPWltYWdlL3Jlc2l6ZSxQXzIw,g_center/format,webp)
  - 在此示例中，验证者 1 是指定的槽领导者。在其时隙期间（验证者被指定为 4 个连续时隙的领导者），验证者 1 构建并提议一个区块。验证器 1 首先通过称为粉碎的过程，将块分解为称为碎片的子块。
  - 粉碎将块数据拆分为最大传输单元 (MTU) 大小的数据碎片（可以从一个节点发送到下一个节点而不将其分成更小的单元的最大数据量），并通过 Reed-Solomon 擦除生成相应的恢复碎片编码方案。
  - 由于 Turbine 从根本上依赖于下游验证器的一系列数据包重传
    - 因此这些验证器可能是恶意的（通过选择重播不正确的数据来对抗拜占庭节点或接收不完整的数据（网络数据包丢失）。
    - 由于 Turbine 的重传树结构（retransmission tree structure），任何网络范围内的数据包丢失更加复杂，并且数据包未能到达目的地的概率在每一跳（hop）上都会增加。
- Reed-Solomon 
  - 纠删码是一种特定类型的前向纠错 (FEC) 算法。纠删码作为一种数据保护方法，即使在传输过程中某些部分丢失或损坏，也可以恢复原始数据
- Turbine 树
  - Turbine 树是 Solana 使用的一种结构化网络拓扑，用于促进验证器之间碎片（编码块数据）的有效传播。
  - 一旦碎片被正确编码到各自的碎片组中，它们就可以通过涡轮树传播，以通知网络中的其他验证器最新的状态。
  - ![alt text](https://image.blockbeats.cn/upload/2023-10-25/ce30e40370fab0b84ede91695677f41c419cddc6.png?x-oss-process=image/quality,q_50/watermark,image_d2F0ZXJtYXJrbmV3LnBuZz94LW9zcy1wcm9jZXNzPWltYWdlL3Jlc2l6ZSxQXzIw,g_center/format,webp)
  - 每个碎片组都通过网络数据包发送到一个特殊的根节点
    - 列表创建：根节点将所有活跃验证者聚合到一个列表中，然后根据每个验证者在网络中的权益进行排序。具有较高权益权重的验证者将优先获得更快的碎片，从而使他们能够更快地用自己的投票消息做出响应以达成共识。
    - 列表改组：然后以确定性方式对该列表进行改组。这将使用从插槽领导者 ID、插槽、碎片索引和碎片类型派生的种子，从每个碎片的验证器节点集生成一个「Turbine 树」。在运行时为每个碎片组生成一棵新树，以减轻与静态树结构相关的潜在安全风险。
    - 层形成：然后从列表顶部开始将节点划分为层。划分基于 DATA_PLANE_FANOUT 值，该值决定涡轮树的宽度和深度。该值会影响碎片在网络中传播的速度。
  - 众所周知的 Turbine 树确保每个验证者确切地知道他们负责中继该碎片的位置。假定当前 DATA_PLANE_FANOUT 值为 6，Turbine 树通常是 4 或 5 跳树（取决于活动验证器的数量）。
  - 此外，如果节点没有获得足够的碎片或者丢失率超过 FEC 率，则节点能够回退到闲话并进行修复。在当前的实现下，缺乏足够碎片来重建块的节点会向领导者发送重传请求。在确定性涡轮机下，任何接收到完整块的节点都可以发送请求节点所需的修复碎片，从而将数据传输进一步向下推送到树中请求数据的区域。